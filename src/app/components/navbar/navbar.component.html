<header
  class="navbar"
  [class.navbar--cart-page]="isCartPage"
  [class.navbar--product-details]="isProductDetailsPage || isProfilePage"
  [class.navbar--products-page]="isProductsPage"
  [class.navbar--wishlist-page]="isWishlistPage"
  [class.navbar--order-history-page]="isOrderHistoryPage"
  [class.navbar--contact-page]="isContactPage"
  [class.navbar--home-page]="isHomePage"
  *ngIf="!isLoginPage"
>
  <div class="navbar__left">
    <a href="#hero" aria-label="Hero" class="navbar__logo-link">
      <img class="navbar__logo" src="/assets/LOGO_Marca.png" alt="Logo" />
    </a>

    <!-- Hamburger Menu Button (Mobile Only) - AFTER logo -->
    <button
      class="navbar__hamburger"
      (click)="toggleMobileMenu()"
      aria-label="Menu"
    >
      <img src="/assets/icons/menu_navbar.png" alt="Menu" />
    </button>

    <!-- Desktop Navigation Links (hidden on cart page, products page, wishlist, and order-history) -->
    <nav
      class="navbar__links"
      *ngIf="
        !isCartPage && !isProductsPage && !isWishlistPage && !isOrderHistoryPage
      "
    >
      <a routerLink="/" routerLinkActive="active-link" [routerLinkActiveOptions]="{ exact: true }">Home</a>
      <a routerLink="/products" routerLinkActive="active-link">Produtos</a>
      <a routerLink="/contact" routerLinkActive="active-link">Contato</a>
      <a href="#footer" *ngIf="isHomePage">Sobre</a>
    </nav>
  </div>

  <div class="navbar__right">
    <!-- Desktop Search Bar (hidden on cart page and products page) -->
    <div
      class="navbar__search navbar__search--desktop"
      *ngIf="!isCartPage && !isProductsPage"
    >
      <input
        type="text"
        placeholder="Buscar"
        [(ngModel)]="searchQuery"
        (ngModelChange)="onSearchChange($event)"
        (focus)="onSearchFocus()"
        (blur)="onSearchBlur()"
      />


      <!-- Search Results Dropdown -->
      <div
        class="navbar__search-results"
        *ngIf="showSearchResults && searchResults.length > 0"
      >
        <div
          class="navbar__search-result-item"
          *ngFor="let product of searchResults"
          (click)="selectProduct(product)"
        >
          <img
            [src]="product.imageSrc"
            [alt]="product.name"
            class="search-result-image"
          />
          <span class="search-result-name">{{ product.name }}</span>
        </div>
      </div>
      <div
        class="navbar__search-results navbar__search-results--empty"
        *ngIf="
          showSearchResults &&
          searchResults.length === 0 &&
          searchQuery.trim().length >= 2
        "
      >
        <p>Nenhum produto encontrado</p>
      </div>
      <!-- Recent Searches -->
      <div
        class="navbar__search-results navbar__recent-searches"
        *ngIf="showRecentSearches && recentSearches.length > 0"
      >
        <div class="recent-searches-header">
          <span>Buscas Recentes</span>
          <button (click)="clearRecentSearches()">Limpar</button>
        </div>
        <div
          class="navbar__search-result-item recent-search-item"
          *ngFor="let term of recentSearches"
          (click)="selectRecentSearch(term)"
        >
          <img src="/assets/lupa_busca.png" alt="Search" class="recent-icon" />
          <span>{{ term }}</span>
        </div>
      </div>
    </div>

    <!-- Mobile Search Icon Button -->
    <button
      class="navbar__search-btn"
      (click)="toggleSearchPopup()"
      aria-label="Buscar"
    >
      <img src="/assets/lupa_busca.png" alt="Buscar" />
    </button>

    <!-- Mobile Profile Icon -->
    <button
      class="navbar__profile-mobile"
      (click)="navigateToLoginOrProfile()"
      aria-label="Perfil"
    >
      <img
        [src]="
          isLoggedIn
            ? userPhotoUrl || '/assets/icons/perfil_guest.svg'
            : '/assets/icons/perfil_guest_sem_login.svg'
        "
        alt="Perfil"
        class="profile-icon"
      />
    </button>

    <button
      class="navbar__btn navbar__btn--outline navbar__btn--desktop"
      *ngIf="!isCartPage && !isProductsPage"
      (click)="navigateToLoginOrProfile()"
    >
      {{ buttonText }}
    </button>

    <!-- Desktop Cart Button -->
    <button
      class="navbar__btn navbar__btn--cart navbar__btn--desktop"
      (click)="goToCart()"
      style="cursor: pointer"
      *ngIf="!isCartPage && !isProductsPage"
    >
      Carrinho {{ cartItemCount }}
    </button>

    <!-- Mobile Cart Icon -->
    <button
      class="navbar__cart-mobile"
      (click)="goToCart()"
      aria-label="Carrinho"
      *ngIf="!isCartPage"
    >
      <img src="/assets/icons/cart_mobile_icon.webp" alt="Carrinho" />
      <span class="navbar__cart-count">{{ cartItemCount }}</span>
    </button>
  </div>

  <!-- Mobile Menu Drawer -->
  <div
    class="navbar__mobile-menu"
    [class.navbar__mobile-menu--open]="isMobileMenuOpen"
  >
    <nav class="navbar__mobile-nav">
      <a
        routerLink="/"
        (click)="closeMobileMenu()"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: true }"
        >Home</a
      >
      <a
        routerLink="/products"
        (click)="closeMobileMenu()"
        routerLinkActive="active"
        >Produtos</a
      >
      <a
        routerLink="/wishlist"
        (click)="closeMobileMenu()"
        routerLinkActive="active"
        >Wishlist</a
      >
      <a
        routerLink="/order-tracking"
        (click)="closeMobileMenu()"
        routerLinkActive="active"
        >Rastreamento</a
      >
      <a
        routerLink="/orders-history"
        (click)="closeMobileMenu()"
        routerLinkActive="active"
        >Histórico de Pedidos</a
      >
      <a
        routerLink="/contact"
        (click)="closeMobileMenu()"
        routerLinkActive="active"
        >Contato</a
      >
    </nav>
  </div>

  <!-- Mobile Menu Overlay -->
  <div
    class="navbar__overlay"
    [class.navbar__overlay--visible]="isMobileMenuOpen"
    (click)="closeMobileMenu()"
  ></div>

  <!-- Search Popup -->
  <div
    class="navbar__search-popup"
    [class.navbar__search-popup--open]="isSearchPopupOpen"
  >
    <div class="navbar__search-popup-content">
      <input
        type="text"
        placeholder="Buscar produtos..."
        [(ngModel)]="searchQuery"
        (ngModelChange)="onSearchChange($event)"
        (focus)="
          showSearchResults =
            searchResults.length > 0 && searchQuery.trim().length >= 2
        "
      />
      <button class="navbar__search-popup-close" (click)="closeSearchPopup()">
        ✕
      </button>
      <!-- Search Results Dropdown (Mobile) -->
      <div
        class="navbar__search-results navbar__search-results--mobile"
        *ngIf="showSearchResults && searchResults.length > 0"
      >
        <div
          class="navbar__search-result-item"
          *ngFor="let product of searchResults"
          (click)="selectProduct(product)"
        >
          <img
            [src]="product.imageSrc"
            [alt]="product.name"
            class="search-result-image"
          />
          <span class="search-result-name">{{ product.name }}</span>
        </div>
      </div>
      <div
        class="navbar__search-results navbar__search-results--mobile navbar__search-results--empty"
        *ngIf="
          showSearchResults &&
          searchResults.length === 0 &&
          searchQuery.trim().length >= 2
        "
      >
        <p>Nenhum produto encontrado</p>
      </div>
      <!-- Recent Searches (Mobile) -->
      <div
        class="navbar__search-results navbar__search-results--mobile navbar__recent-searches"
        *ngIf="showRecentSearches && recentSearches.length > 0"
      >
        <div class="recent-searches-header">
          <span>Buscas Recentes</span>
          <button (click)="clearRecentSearches()">Limpar</button>
        </div>
        <div
          class="navbar__search-result-item recent-search-item"
          *ngFor="let term of recentSearches"
          (click)="selectRecentSearch(term)"
        >
          <img src="/assets/lupa_busca.png" alt="Search" class="recent-icon" />
          <span>{{ term }}</span>
        </div>
      </div>
    </div>
  </div>
</header>
